# K-겹 교차 검증 (K-Fold Cross Validation) 및 모델 저장

**`260107 딥러닝 04.py`** 파일은 초음파(Sonar) 데이터를 활용한 **이진 분류** 예제입니다. 기존의 학습/테스트 데이터 분리 방식 외에, 데이터셋이 적을 때 유용한 **K-겹 교차 검증**과 **모델 저장/불러오기** 기능을 중점적으로 다룹니다.

## 1. 주요 개념: K-겹 교차 검증 (K-Fold Cross Validation)

데이터 수가 적을 때, 단순히 학습용(Train)과 테스트용(Test)으로 한 번만 나누면, **나누는 데이터의 구성에 따라 정확도 차이가 크게 발생**할 수 있습니다. 이를 보완하기 위해 사용하는 방법입니다.

- **작동 원리**:

  1. 전체 데이터를 **K개**(예: 5개)의 폴드(Fold)로 등분합니다.
  2. 첫 번째 폴드를 테스트셋으로, 나머지(K-1개)를 학습셋으로 사용하여 모델을 학습하고 평가합니다.
  3. 테스트셋을 다음 폴드로 바꾸어가며 이 과정을 **K번 반복**합니다.
  4. K개의 정확도를 평균 내어 모델의 일반화된 성능을 평가합니다.

- **장점**: 모든 데이터를 학습과 평가에 사용할 수 있어 데이터 낭비를 줄이고, 과적합(Overfitting) 여부를 더 잘 파악할 수 있습니다.

- **코드 핵심**:
  - `KFold(n_splits=5, shuffle=True)`: 데이터를 섞어서 5등분
  - `model_fn()` 함수: 매 반복(Fold)마다 **초기화된 새 모델**을 생성하기 위해 사용 (중요)

## 2. 모델 저장 및 불러오기 (Model Save & Load)

학습 완료된 모델의 구조와 가중치를 파일로 저장해두면, 나중에 재학습 없이 바로 예측에 사용할 수 있습니다.

- **저장**: `model.save('경로/파일명.keras')`
  - **참고**: Keras 3.0부터는 `.keras` 확장자를 권장합니다 (기존 `.h5` 대신).
- **불러오기**: `load_model('경로/파일명.keras')`
  - `from tensorflow.keras.models import load_model` 필요

## 3. 실습 코드 흐름 요약

1. **데이터 로드**: Sonar 데이터 (광물 vs 암석)
2. **일반 학습/평가**: `train_test_split`으로 7:3 분리 후 1회 학습 및 평가
3. **모델 저장**: 학습된 모델을 `.keras` 파일로 저장
4. **모델 로드**: 저장된 모델을 다시 불러와서 평가 (결과 동일 확인)
5. **K-겹 교차 검증**: 데이터 전체를 5등분하여 5번 반복 학습/평가 후 평균 정확도 도출

## 4. 이진 분류 모델 구조 (복습)

- **입력층**: `input_dim=60` (속성 60개)
- **출력층**: `Dense(1, activation='sigmoid')` (0~1 사이 확률값)
- **오차 함수**: `loss='binary_crossentropy'`
